namespace SpriteKind {
    export const gun = SpriteKind.create()
    export const CameraTrigger = SpriteKind.create()
    export const HUD = SpriteKind.create()
    export const OffscreenProjectile = SpriteKind.create()
    export const DestroyedPlayer = SpriteKind.create()
}
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(0, 1, 0, -10)
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (canShoot) {
        updateInputMode((inputMode + 1) % 2)
        offscreenHorizontally = vehicleSprite.right < scene.cameraLeft() || vehicleSprite.left > scene.cameraLeft() + scene.screenWidth()
        offscreenVertically = vehicleSprite.bottom < scene.cameraTop() || vehicleSprite.top > scene.cameraTop() + scene.screenHeight()
        if (offscreenHorizontally || offscreenVertically) {
            scene.centerCameraAt(vehicleSprite.x, vehicleSprite.y - 8)
        }
    }
})
controller.up.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(0, 2, 0, -5)
})
function cameraFollowSprite (toFollow: Sprite) {
    scene.cameraFollowSprite(bullet)
    cameraSprite = bullet
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (canShoot) {
        canShoot = false
        updateInputMode(1)
        bullet = sprites.create(img`
            . . . . . 
            . . 4 . . 
            . 4 8 4 . 
            . . 4 . . 
            . . . . . 
            `, SpriteKind.Projectile)
        positionSpriteRelativeTo(gunSprite, sprites.readDataNumber(vehicleSprite, "gunEndX") - gunSpriteHalfWidth, sprites.readDataNumber(vehicleSprite, "gunEndY") - gunSpriteHalfWidth, bullet)
        if (sprites.allOfKind(SpriteKind.Projectile).length == 1) {
            cameraFollowSprite(bullet)
        }
        bullet.ay = 100
        bullet.ax = windSpeed
        bullet.setFlag(SpriteFlag.DestroyOnWall, true)
        bullet.vx = sprites.readDataNumber(vehicleSprite, "gunUnitX") * sprites.readDataNumber(vehicleSprite, "bulletPower")
        bullet.vy = sprites.readDataNumber(vehicleSprite, "gunUnitY") * (0 - sprites.readDataNumber(vehicleSprite, "bulletPower"))
    }
})
sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Player, function (sprite, otherSprite) {
    sprite.destroy()
    vehicleToDeleteIndex = vehicleSprites.indexOf(otherSprite)
    if (vehicleToDeleteIndex <= activePlayer) {
        activePlayer += -1
    }
    gunSprites.removeAt(vehicleToDeleteIndex).destroy()
    vehicleSprites.removeAt(vehicleToDeleteIndex).destroy(effects.fire, 500)
    viewTrigger = sprites.create(image.create(0, 0), SpriteKind.CameraTrigger)
    viewTrigger.lifespan = 3000
})
controller.right.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(-3, 0, 5, 0)
})
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(1, 0, -10, 0)
})
function updateHUDValue (hudSprite: Sprite, value: string) {
    hudSprite.image.fillRect(0, 0, hudSprite.width, hudSprite.height, 0)
    localExtensions.drawText5In(
    value,
    hudSprite.image,
    0,
    0,
    1
    )
}
function drawTurrent () {
    sprites.setDataNumber(vehicleSprite, "gunAngle", (sprites.readDataNumber(vehicleSprite, "gunAngle") + 360) % 360)
    sprites.setDataNumber(vehicleSprite, "bulletPower", Math.constrain(sprites.readDataNumber(vehicleSprite, "bulletPower"), 0, 350))
    gunSprite.setImage(image.create(gunSprite.width, gunSprite.height))
    sprites.setDataNumber(vehicleSprite, "gunAngleRad", sprites.readDataNumber(vehicleSprite, "gunAngle") * (3.14159 / 180))
    sprites.setDataNumber(vehicleSprite, "gunUnitX", Math.cos(sprites.readDataNumber(vehicleSprite, "gunAngleRad")))
    sprites.setDataNumber(vehicleSprite, "gunUnitY", Math.sin(sprites.readDataNumber(vehicleSprite, "gunAngleRad")))
    sprites.setDataNumber(vehicleSprite, "gunEndX", Math.round(sprites.readDataNumber(vehicleSprite, "gunUnitX") * gunLength + gunSpriteHalfWidth))
    sprites.setDataNumber(vehicleSprite, "gunEndY", Math.round(gunSpriteHalfWidth - sprites.readDataNumber(vehicleSprite, "gunUnitY") * gunLength))
    gunSprite.image.drawLine(gunSpriteHalfWidth, gunSpriteHalfWidth, sprites.readDataNumber(vehicleSprite, "gunEndX"), sprites.readDataNumber(vehicleSprite, "gunEndY"), 8)
    updateHUDValue(powerLabel, convertToText(sprites.readDataNumber(vehicleSprite, "bulletPower")))
    updateHUDValue(angleLabel, convertToText(sprites.readDataNumber(vehicleSprite, "gunAngle")))
}
function initAllHUDSprites () {
    panIndicator = sprites.create(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ...............................................................................666..............................................................................
        ..............................................................................66166.............................................................................
        .............................................................................6611166............................................................................
        ............................................................................661111166...........................................................................
        ...........................................................................66111611166..........................................................................
        ..........................................................................6611166611166.........................................................................
        .........................................................................6611166.6611166........................................................................
        ........................................................................6611166...6611166.......................................................................
        ........................................................................611166.....661116.......................................................................
        ........................................................................61166.......66116.......................................................................
        ........................................................................6166.........6616.......................................................................
        ........................................................................666...........666.......................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ............66666...............................................................................................................................66666...........
        ...........661116...............................................................................................................................611166..........
        ..........6611166...............................................................................................................................6611166.........
        .........6611166.................................................................................................................................6611166........
        ........6611166...................................................................................................................................6611166.......
        .......6611166.....................................................................................................................................6611166......
        ......6611166.......................................................................................................................................6611166.....
        .....6611166.........................................................................................................................................6611166....
        .....611166...........................................................................................................................................661116....
        .....6611166.........................................................................................................................................6611166....
        ......6611166.......................................................................................................................................6611166.....
        .......6611166.....................................................................................................................................6611166......
        ........6611166...................................................................................................................................6611166.......
        .........6611166.................................................................................................................................6611166........
        ..........6611166...............................................................................................................................6611166.........
        ...........661116...............................................................................................................................611166..........
        ............66666...............................................................................................................................66666...........
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ........................................................................666...........666.......................................................................
        ........................................................................6166.........6616.......................................................................
        ........................................................................61166.......66116.......................................................................
        ........................................................................611166.....661116.......................................................................
        ........................................................................6611166...6611166.......................................................................
        .........................................................................6611166.6611166........................................................................
        ..........................................................................6611166611166.........................................................................
        ...........................................................................66111611166..........................................................................
        ............................................................................661111166...........................................................................
        .............................................................................6611166............................................................................
        ..............................................................................66166.............................................................................
        ...............................................................................666..............................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `, SpriteKind.HUD)
    windLegend = sprites.create(img`
        . . . . . . . . . . . . . . . . . . . . 
        1 . . . 1 . . 1 . . 1 . . 1 . . 1 1 1 . 
        1 . . . 1 . . 1 . . 1 1 . 1 . . 1 . . 1 
        1 . 1 . 1 . . 1 . . 1 1 1 1 . . 1 . . 1 
        1 . 1 . 1 . . 1 . . 1 . 1 1 . . 1 . . 1 
        1 1 1 1 . . . 1 . . 1 . . 1 . . 1 1 1 . 
        . . . . . . . . . . . . . . . . . . . . 
        `, SpriteKind.HUD)
    windLegend.image.replace(1, hudTextColor)
    windIndicator = sprites.create(img`
        . . . . . . . 1 1 . . . 
        . . . . . . . 1 1 1 . . 
        1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 1 1 1 1 1 1 1 1 1 1 
        1 1 1 1 1 1 1 1 1 1 1 . 
        . . . . . . . 1 1 1 . . 
        . . . . . . . 1 1 . . . 
        `, SpriteKind.HUD)
    windIndicator.image.replace(1, hudTextColor)
    windLabel = sprites.create(image.create(12, 5), SpriteKind.HUD)
    updateHUDValue(windLabel, convertToText(Math.abs(windSpeed)))
    legend = sprites.create(img`
        . . . 1 1 . . . 
        . . . . 1 1 1 . 
        1 1 1 1 1 1 1 1 
        . . . . 1 1 1 . 
        . . . 1 1 . . . 
        . . . . . . . . 
        . 1 . . . . . . 
        . 1 . . . . . . 
        . 1 1 1 . . . . 
        . 1 . . 1 . . . 
        . 1 . . . 1 . . 
        . 1 1 1 1 1 1 . 
        `, SpriteKind.HUD)
    legend.image.replace(1, hudTextColor)
    angleLabel = sprites.create(image.create(26, 5), SpriteKind.HUD)
    powerLabel = sprites.create(image.create(26, 5), SpriteKind.HUD)
    initHUDSprite(windLegend, scene.screenWidth() - 54, 3)
    initHUDSprite(windIndicator, scene.screenWidth() - 30, 3)
    initHUDSprite(windLabel, scene.screenWidth() - 14, 4)
    initHUDSprite(panIndicator, 0, 0)
    initHUDSprite(legend, 2, scene.screenHeight() - 14)
    initHUDSprite(angleLabel, 12, scene.screenHeight() - 7)
    initHUDSprite(powerLabel, 12, scene.screenHeight() - 14)
    if (windSpeed == 0) {
        windLegend.setFlag(SpriteFlag.Invisible, true)
        windIndicator.setFlag(SpriteFlag.Invisible, true)
        windLabel.setFlag(SpriteFlag.Invisible, true)
    } else if (windSpeed < 0) {
        windIndicator.image.flipX()
    }
}
sprites.onDestroyed(SpriteKind.CameraTrigger, function (sprite) {
    if (sprites.allOfKind(SpriteKind.CameraTrigger).length == 0 && sprites.allOfKind(SpriteKind.Projectile).length == 0) {
        canShoot = true
        updateActivePlayer((activePlayer + 1) % vehicleSprites.length)
        scene.centerCameraAt(vehicleSprite.x, vehicleSprite.y - 8)
        if (sprites.allOfKind(SpriteKind.Player).length == 1) {
            game.over(true)
        }
    }
})
function initHUDSprite (hudSprite: Sprite, left: number, top: number) {
    hudSprite.setFlag(SpriteFlag.RelativeToCamera, true)
    hudSprite.left = left
    hudSprite.top = top
    hudSprite.z = 100
}
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(-1, 0, 10, 0)
})
function updateInputMode (mode: number) {
    inputMode = mode
    panIndicator.setFlag(SpriteFlag.Invisible, inputMode != 0)
    legend.setFlag(SpriteFlag.Invisible, inputMode == 0)
    powerLabel.setFlag(SpriteFlag.Invisible, inputMode == 0)
    angleLabel.setFlag(SpriteFlag.Invisible, inputMode == 0)
}
controller.down.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(0, -2, 0, 5)
})
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(0, -1, 0, 10)
})
function initTilemap () {
    hudTextColor = 1
    if (Math.percentChance(75)) {
        scene.setBackgroundColor(9)
        tiles.setTilemap(tilemap`level4`)
    } else if (Math.percentChance(75)) {
        scene.setBackgroundColor(9)
        tiles.setTilemap(tilemap`level5`)
    } else {
        scene.setBackgroundColor(11)
        tiles.setTilemap(tilemap`level6`)
    }
}
function updateActivePlayer (nextActive: number) {
    activePlayer = nextActive
    vehicleSprite = vehicleSprites[activePlayer]
    gunSprite = gunSprites[activePlayer]
    updateHUDValue(powerLabel, convertToText(sprites.readDataNumber(vehicleSprite, "bulletPower")))
    updateHUDValue(angleLabel, convertToText(sprites.readDataNumber(vehicleSprite, "gunAngle")))
    activePlayerNotification = sprites.create(image.create(100, 9), SpriteKind.HUD)
    activePlayerNotification.image.fillRect(0, 0, activePlayerNotification.width, activePlayerNotification.height, 5)
    localExtensions.drawText5In(
    "" + sprites.readDataString(vehicleSprite, "playerName") + " turn...",
    activePlayerNotification.image,
    2,
    2,
    8
    )
initHUDSprite(activePlayerNotification, 30, 32)
    activePlayerNotification.lifespan = 1800
}
function handleDirectionInput (rotationChange: number, powerChange: number, cameraOffsetXChange: number, cameraOffsetYChange: number) {
    if (inputMode == 0) {
        scene.centerCameraAt(scene.cameraLeft() + (scene.screenWidth() / 2 + cameraOffsetXChange), scene.cameraTop() + (scene.screenHeight() / 2 + cameraOffsetYChange))
    } else {
        sprites.changeDataNumberBy(vehicleSprite, "gunAngle", rotationChange)
        sprites.changeDataNumberBy(vehicleSprite, "bulletPower", powerChange)
        drawTurrent()
    }
}
sprites.onDestroyed(SpriteKind.Projectile, function (sprite) {
    if (sprite.top <= 0) {
        bullet = sprites.create(sprite.image, SpriteKind.OffscreenProjectile)
        bullet.setPosition(sprite.x, sprite.y)
        bullet.ay = sprite.ay
        bullet.setVelocity(sprite.vx, sprite.vy)
        bullet.setFlag(SpriteFlag.Ghost, true)
        bullet.setFlag(SpriteFlag.DestroyOnWall, true)
        if (sprite == cameraSprite) {
            cameraFollowSprite(bullet)
        }
    } else {
        if (!(sprite.isHittingTile(CollisionDirection.Left) || sprite.isHittingTile(CollisionDirection.Left))) {
            scene.cameraShake(2, 400)
        }
        viewTrigger = sprites.create(image.create(0, 0), SpriteKind.CameraTrigger)
        viewTrigger.lifespan = 600
    }
})
function positionSpriteRelativeTo (source: Sprite, offsetX: number, offsetY: number, spriteToPosition: Sprite) {
    spriteToPosition.setPosition(source.x + offsetX, source.y + offsetY)
}
controller.left.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(3, 0, -5, 0)
})
/**
 * 1.0: initial release
 * 
 * 2.0:
 * 
 * - bugfix: fix bug moving to next player after a vehicle is destroyed (only affects 3+ player count games)
 * 
 * - add wind
 * 
 * - add two new (low probability) alternate levels
 * 
 * - prompt for player count
 */
let legend: Sprite = null
let windLabel: Sprite = null
let windIndicator: Sprite = null
let hudTextColor = 0
let windLegend: Sprite = null
let panIndicator: Sprite = null
let angleLabel: Sprite = null
let powerLabel: Sprite = null
let viewTrigger: Sprite = null
let vehicleToDeleteIndex = 0
let cameraSprite: Sprite = null
let bullet: Sprite = null
let offscreenVertically = false
let offscreenHorizontally = false
let inputMode = 0
let gunSprite: Sprite = null
let windSpeed = 0
let gunSpriteHalfWidth = 0
let gunLength = 0
let gunSprites: Sprite[] = []
let vehicleSprites: Sprite[] = []
let activePlayer = 0
let canShoot = false
let activePlayerNotification: Sprite = null
let vehicleSprite: Sprite = null
let playerCount = 2
if (blockSettings.exists("vehicles.playerCount")) {
    playerCount = blockSettings.readNumber("vehicles.playerCount")
}
playerCount = localExtensions.askForNumber(
"players",
2,
5,
playerCount
)
blockSettings.writeNumber("vehicles.playerCount", playerCount)
canShoot = true
activePlayer = 0
vehicleSprites = sprites.allOfKind(SpriteKind.Player)
gunSprites = sprites.allOfKind(SpriteKind.gun)
gunLength = 7
gunSpriteHalfWidth = 10
let maxWindSpeed = 20
let vehicleDesigns = [img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e e e e e e . . . . . 
    . . . e e f f f f f f e e . . . 
    . . e f f 7 7 e 7 7 7 f f e . . 
    . e f f 7 e 7 7 7 e 7 7 f f e . 
    . e f e 7 7 7 e 7 7 7 e 7 f e . 
    e f 7 7 7 e 7 7 7 e 7 7 e 7 f e 
    f b d f c c 7 c c 7 c c d f b f 
    e b f f 9 9 9 9 9 9 9 9 f f b e 
    . e e c e e c e e c e e c e e . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e e e e e e . . . . 3 
    . . . e e f f f f f f e e . . . 
    . . e f f a a e a a a f f e . . 
    . e f f a e a a a e a a f f e . 
    . e f e a a a e a a a e a f e . 
    e f a a a e a a a a a a e a f e 
    f b d f c c a a c a c c d f b f 
    e b f f a a a a a a a 3 f f b e 
    . e e c e e c e e c e e c e e . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e e e e e e . . . . . 
    . . . e e f f f f f f e e . . . 
    . . e f f 3 3 e 3 3 3 f f e . . 
    . e f f 3 e 3 3 3 e 3 3 f f e . 
    . e f e 3 3 3 e 3 3 3 e 3 f e . 
    e f 3 3 3 e 3 3 3 e 3 3 e 3 f e 
    f b d f c c 3 c c 3 c c d f b f 
    e b f f 3 3 3 3 3 3 3 3 f f b e 
    . e e c e e c e e c e e c e e . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e e e e e e . . . . . 
    . . . e e f f f f f f e e . . . 
    . . e f f 4 4 e 4 4 4 f f e . . 
    . e f f 4 e 4 4 4 e 4 4 f f e . 
    . e f e 4 4 4 e 4 4 4 e 4 f e . 
    e f 4 4 4 e 4 4 4 e 4 4 e 4 f e 
    f b d f c c 4 c c 4 c c d f b f 
    e b f f 4 4 4 4 4 4 4 4 f f b e 
    . e e c e e c e e c e e c e e . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e e e e e e . . . . . 
    . . . e e f f f f f f e e . . . 
    . . e f f 8 8 e 8 8 8 f f e . . 
    . e f f 8 e 8 8 8 e 8 8 f f e . 
    . e f e 8 8 8 e 8 8 8 8 8 f e . 
    e f 8 8 8 e 8 8 8 e 8 8 e 8 f e 
    f b d f c c 8 c c 8 c c d f b f 
    e b f f 8 8 8 8 8 8 8 8 f f b e 
    . e e c e e c e e c e e c e e . 
    `]
initTilemap()
windSpeed = randint(0 - maxWindSpeed, maxWindSpeed)
initAllHUDSprites()
updateInputMode(0)
for (let index = 0; index <= playerCount - 1; index++) {
    gunSprite = sprites.create(image.create(21, 21), SpriteKind.gun)
    vehicleSprite = sprites.create(vehicleDesigns[index % vehicleDesigns.length], SpriteKind.Player)
    vehicleSprites.push(vehicleSprite)
    gunSprites.push(gunSprite)
    sprites.setDataNumber(vehicleSprite, "gunAngle", randint(30, 150))
    sprites.setDataNumber(vehicleSprite, "bulletPower", 100)
    sprites.setDataString(vehicleSprite, "playerName", "Player " + (index + 1))
    tiles.placeOnRandomTile(vehicleSprite, assets.tile`tile3`)
    positionSpriteRelativeTo(vehicleSprite, 0, 0, gunSprite)
    tiles.setTileAt(tiles.getTileLocation(Math.trunc(vehicleSprite.x / 16), Math.trunc(vehicleSprite.y / 16)), assets.tile`tile0`)
    drawTurrent()
}
for (let value of tiles.getTilesByType(assets.tile`tile3`)) {
    tiles.setTileAt(value, assets.tile`tile0`)
}
updateActivePlayer(activePlayer)
scene.centerCameraAt(vehicleSprite.x, vehicleSprite.y - 8)
game.onUpdate(function () {
    for (let value2 of sprites.allOfKind(SpriteKind.OffscreenProjectile)) {
        if (value2.top >= 0) {
            value2.setFlag(SpriteFlag.Ghost, false)
            value2.setKind(SpriteKind.Projectile)
        }
    }
})
